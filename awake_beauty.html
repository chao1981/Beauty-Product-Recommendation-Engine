<!doctype html>
<html lang="en">
 <head>
  <!--set up basics-->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE-edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- title and everything has to come after set up basics codes-->
  <h1 style="text-align:center">Beauty Search Engine</h1>
  
  <!--Bootstrap-->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

  <!--import libraries-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

  <style>
    
    body {background-color:lightblue}
    h1   {color:plum}
    input{color:black}

    
    .wrapper {
       width: 800px;
       margin-left: auto;
       margin-right: auto;
       margin-bottom: 0px;
     }
     #bar_chart {
       margin-bottom: 0 px;
     }
    .bar {
       fill: #FF75A3;
     }
     span {
       color: steelblue;
     }

  

  

    .condition_box {
    float: left;
    margin: 1%;
    padding: 10px;
    width: 20%;
    height: 350px;
    border: 2px solid black;
} 
    .result_box {
    float: left;
    margin: 1%;
    padding: 10px;
    width: 30%;
    height: 350px;
    border: 2px solid black;

    }
    .panel-body .review_summary{
      font-size: 14px;
    }

    .chart {

    }

    .main text {
    font: 10px sans-serif;  
    }

    .axis line, .axis path {
    shape-rendering: crispEdges;
    stroke: black;
    fill: none;
  }

    circle {
    fill: steelblue;
    }

</style>
</head>

<body>
  <div class="container">

      <!-- The justified navigation menu is meant for single line per list item.
           Multiple lines will require custom code not provided by Bootstrap. -->
    <div class="masthead">
      
        <nav>
          <ul class="nav nav-justified">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#">Projects</a></li>
            <li><a href="#">Services</a></li>
            <li><a href="#">Downloads</a></li>
            <li><a href="#">About</a></li>
            <li><a href="#">Contact</a></li>
          </ul>
        </nav>
    </div>

      <!-- Jumbotron -->
    <div class="jumbotron">
      <form>
        <fieldset><p>
        <legend> Your beauty profile</legend>
          <div class="condition_box " >
           <h2> Skin type </h2>
          <div class="radio">
           <label>
          <input type="radio"  name="skin_type" value="dry_skin_score" id="dry_skin"> Dry Skin
            </label>
          </div>
          
          <div class="radio" >
           <label>
          <input type="radio" name="skin_type" value="oily_skin_score" id="oily_skin"> Oily Skin
            </label>
          </div>
          
          <div class="radio" >
           <label>
          <input type="radio" name="skin_type" value="combination_skin_score" id="combination_skin"> Combination Skin
            </label>
          </div>
          
         <!--  <div class="radio" >
           <label>
          <input type="radio" name="skin_type" value="0.0" id="normal_skin"> Normal Skin
            </label>
          </div> -->
      </div>

    <div class="condition_box" >
      <h2>Main concern</h2>
        <div class="radio" >
           <label>
          <input type="radio" name="main_concern" value="dry_skin_score"> Dry Skin
            </label>
          </div>
          
          <div class="radio" >
           <label>
          <input type="radio" name="main_concern" value="acne_score"> Acne
            </label>
          </div>
          
          <div class="radio" >
           <label>
          <input type="radio" name="main_concern" value="anti_aging_score"> Anti-Aging
            </label>
          </div>

          <div class="radio" >
           <label>
          <input type="radio" name="main_concern" value="redness_score"> Redness
            </label>
          </div>
    </div>

    <div class="condition_box ">
      <h2>Other concerns</h2>
        <div class="checkbox" method="get" >
           <label>
          <input type="checkbox" name="check" value="dry_skin_score"> Dry Skin
            </label>
          </div>
          
          <div class="checkbox" method="get">
           <label>
          <input type="checkbox" name="check" value="acne_score"> Acne
            </label>
          </div>
          
          <div class="checkbox" method="get">
           <label>
          <input type="checkbox" name="check" value="anti_aging_score"> Anti-Aging
            </label>
          </div>
          
          <div class="checkbox" method="get">
           <label>
          <input type="checkbox" name="check" value="redness_score"> Redness
            </label>
          </div>

          <div class="checkbox" method="get">
           <label>
          <input type="checkbox" name="check" value="sensitive_score"> Sensitive Skin
            </label>
          </div>

          <div class="checkbox" method="get">
           <label>
          <input type="checkbox" name="check" value="sunscreen_score"> Sun Protection
            </label>
          </div>
    </div>

   <div class="condition_box ">
      <h2>What else?</h2>
      <textarea name="extra_information" rows="10" cols="20" id="textbox"></textarea>  
    </div>
  <!--   <input type="submit" value="submit"> -->
  </p>
  <div>
  <button type="submit" class="btn btn-success btn-lg">
  <span class="glyphicon glyphicon-heart" aria-hidden="true"></span> GO
  </button>
</div>

  </fieldset>
</form>

  </div>

      <!-- Example row of columns -->
    <div class="jumbotron">
      <legend>We recommend:</legend>
      <div class="row">
        <div class="col-lg-4">
          <div class="products" id="product_1">
            <h2>Product 1</h2>
          </div>
        
        <div class="panel panel-default">
          <div class="panel-heading" role="tab" id="headingTwo">
            <h4 class="panel-title">
              <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="false" aria-controls="collapseOne">Product Details
              </a>
            </h4>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
            <div class="panel-body" id="product_1_details" >
              <div>
               <h5>Price:</h5>
                <p id="Price_1"></p> 
              </div>
              
              <div>
                <h5>Average rating (out of 5):</h5>
                <p id="rating1"></p> 
              </div>

              <div>
                <h5>Number of reviews:</h5>
                <p id="num1"></p> 
              </div>

              <div>
                <h5>Reviews Summary:</h5>
                <p class="review_summary" id="reviews_summary1" >
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
        

       <div class="col-lg-4">
          <div class="products" id="product_2">
            <h2>Product 2</h2>
          </div>
          <div class="panel panel-default">
            <div class="panel-heading" role="tab" id="headingTwo">
              <h4 class="panel-title">
                <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">Product Details
                </a>
              </h4>
            </div>
            <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
              <div class="panel-body" id="product_2_details" >
                <div>
                  <h5>Price:</h5>
                  <p id="Price_2"></p> 
                </div>

                <div>
                  <h5>Average rating (out of 5):</h5>
                  <p id="rating2"></p> 
                </div>

                <div>
                  <h5>Number of reviews:</h5>
                  <p id="num2"></p> 
                </div>

                <div>
                  <h5>Reviews Summary:</h5>
                  <p class="review_summary" id="reviews_summary2" >
                  </p>
                </div> 
              </div>
            </div>
          </div>
        </div>

        <div class="col-lg-4">
          <div class="products" id="product_3">
            <h2>Product 3</h2>
          </div>
         

        <div class="panel panel-default">
          <div class="panel-heading" role="tab" id="headingTwo">
            <h4 class="panel-title">
              <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">Product Details
              </a>
            </h4>
          </div>
          <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
            <div class="panel-body" >
              <div>
                  <h5>Price:</h5>
                  <p id="Price_3"></p> 
              </div>

                <div>
                  <h5>Average rating (out of 5):</h5>
                  <p id="rating3"></p> 
                </div>

                <div>
                  <h5>Number of reviews:</h5>
                  <p id="num3"></p> 
                </div>

                <div>
                  <h5>Reviews Summary:</h5>
                  <p class="review_summary" id="reviews_summary3">
                  </p>
                </div> 
            </div>
          </div>
        </div>
      </div>
        </div>

      </div>
    </div>
    <div class="jumbotron">
      <div class="container" id="d3_graph">
        <h4>How much people likes these product over the year:</h4>
        <h5> (0=neutral , positive=like, negative=dislike)</h5> 
        
      </div>
    </div>
    
 

      <!-- Site footer -->
      <footer class="footer">
        <p>&copy; Poro & Skylar </p>
      </footer>

  </div> <!-- /container -->
<!-- <div class="jumbotron">
      <div class="container" id="d3_graph">
        <h4>How much people likes these product over the year:</h4>
        <h5> O : neutral , positive : like, negative : dislike</h5> 
        
      </div>
    </div> -->

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<script>
  $('form').on('submit', function(e) {
    e.preventDefault();
    e.returnValue = false;
    recommend_product()
    
  });

  // function make_graph(data) {
  //   var margin = {top: 20, right: 15, bottom: 60, left: 60}
  //     , width = 960 - margin.left - margin.right
  //     , height = 500 - margin.top - margin.bottom;
  
  function make_graph(data) {
    var margin = {top: 20, right: 15, bottom: 40, left: 40}
      , width = 350 - margin.left - margin.right
      , height = 300 - margin.top - margin.bottom;
    
    real_date = data[0][0];

    var dates = data.map(function(d){
                return new Date(d[0]);
    })
    console.log('dates', dates);
    console.log(d3.extent(dates));

 x = d3.time.scale()
              .domain(d3.extent(dates))
              .range([ 0, width ]);

    // var x = d3.time.scale()
    //           .domain(d3.extent(data, function(d) { console.log(d);
    //             console.log(d3.time.format("%b %e" )(new Date(d[0])));
    //             return d3.time.format("%b %e" )(new Date(d[0])); }))
    //           .range([ 0, width ]);

    
    var y = d3.scale.linear()
            .domain([0, d3.max(data, function(d) { return d[1]; })])
            .range([ height, 0 ]);
 
    var chart = d3.select("#d3_graph")
  .append('svg:svg')
  .attr('width', width + margin.right + margin.left)
  .attr('height', height + margin.top + margin.bottom)
  .attr('class', 'chart')

    var main = chart.append('g')
  .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
  .attr('width', width)
  .attr('height', height)
  .attr('class', 'main')   
        
    // draw the x axis
    var xAxis = d3.svg.axis()
  .scale(x)
  .orient('bottom');

    main.append('g')
  .attr('transform', 'translate(0,' + height + ')')
  .attr('class', 'main axis date')
  .call(xAxis);

    // draw the y axis
    var yAxis = d3.svg.axis()
  .scale(y)
  .orient('left');

    main.append('g')
  .attr('transform', 'translate(0,0)')
  .attr('class', 'main axis date')
  .call(yAxis);

    var g = main.append("svg:g"); 
    
    g.selectAll("scatter-dots")
      .data(data)
      .enter().append("svg:circle")
          .attr("cx", function (d,i) { return x(new Date(d[0])); } )
          .attr("cy", function (d) { return y(d[1]); } )
          .attr("r", 3);
  };

  function recommend_product(){
    var other_concerns = $.map($("input:checkbox:checked"), function(elem){return $(elem).val();});

    var skin_id = $('input[name="skin_type"]:checked').val();

    var priority_concern = $('input[name="main_concern"]:checked').val();

    var user_spec = document.getElementById("textbox").value;

    var input_data = "{\"skin_type\": [\"" + skin_id + "\"],\"priority\":[\"" + priority_concern + "\"],\"others\":[\"" + other_concerns + "\"],\"extra_info\":[\"" + user_spec + "\"]}";
    // console.log(input_data);


    $.ajax({
      type:"POST",
      contentType: "application/json; charset=utf-8",
      url:"/recommendation",
      dataType:"json",
      async:true,
      data: input_data,
      success: function(data){
        
        console.log('data is', data);
        $("#product_1").text(data[1][0]);
        $("#Price_1").text("$" + data[1][4]);
        $("#reviews_summary1").text(data[1][3]);
        $("#rating1").text(data[1][1]);
        $("#num1").text(data[1][2]);
        
        $("#product_2").text(data[2][0]);
        $("#Price_2").text("$" + data[2][4]);
        $("#reviews_summary2").text(data[2][3]);
        $("#rating2").text(data[2][1]);
        $("#num2").text(data[2][2]);
        
        $("#product_3").text(data[3][0]);
        $("#Price_3").text("$" + data[3][4]);
        $("#reviews_summary3").text(data[3][3]);
        $("#rating3").text(data[3][1]);
        $("#num3").text(data[3][2]);

        make_graph(data["graph_data1"]);
        make_graph(data["graph_data2"]);
        make_graph(data["graph_data3"]);


        // var mytextbox = document.getElementById("product_1");
        //                           mytextbox = mytextbox.value+ data.keys()[1];
                                  },
      error: function(result) { console.log("error!", result)}


    })

  }

  
</script>





 
   

</body>



</html>